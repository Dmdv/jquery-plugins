/**
 * Observable plugin
 *
 * Copyright (c) 2010 Filatov Dmitry (alpha@zforms.ru)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * @version 1.0.1
 * @requires $.identify
 * @requires $.inherit
 */(function(a,b){var c="__"+ +(new Date)+"storage",d=function(b,c){return a.identify(b)+(c?a.identify(c):"")},e={buildEventName:function(a){return a},on:function(e,f,g,h,i){if(typeof e=="string"){a.isFunction(f)&&(h=g,g=f,f=b);var j=d(g,h),k=this[c]||(this[c]={}),l=e.split(" "),m=0,n;while(e=l[m++]){e=this.buildEventName(e),n=k[e]||(k[e]={ids:{},list:{}});if(!(j in n.ids)){var o=n.list,p={fn:g,data:f,ctx:h,special:i};o.last?(o.last.next=p,p.prev=o.last):o.first=p,n.ids[j]=o.last=p}}}else{var q=this;a.each(e,function(a,b){q.on(a,b,f,i)})}return this},once:function(a,b,c,d){return this.on(a,b,c,d,{one:!0})},un:function(b,e,f){if(typeof b=="string"||typeof b=="undefined"){var g=this[c];if(g)if(b){var h=b.split(" "),i=0,j;while(b=h[i++]){b=this.buildEventName(b);if(j=g[b])if(e){var k=d(e,f),l=j.ids;if(k in l){var m=j.list,n=l[k],o=n.prev,p=n.next;o?o.next=p:n===m.first&&(m.first=p),p?p.prev=o:n===m.last&&(m.last=o),delete l[k]}}else delete this[c][b]}}else delete this[c]}else{var q=this;a.each(b,function(a,b){q.un(a,b,f)})}return this},trigger:function(b,d){var e=this,f=e[c],g;typeof b=="string"?b=a.Event(e.buildEventName(g=b)):b.type=e.buildEventName(g=b.type);if(f&&(f=f[b.type])){var h=f.list.first,i;while(h)b.data=h.data,i=h.fn.call(h.ctx||e,b,d),typeof i!="undefined"&&(b.result=i,i===!1&&(b.preventDefault(),b.stopPropagation())),h.special&&h.special.one&&e.un(g,h.fn,h.ctx),h=h.next}return this}};a.observable=a.inherit(e,e)})(jQuery);